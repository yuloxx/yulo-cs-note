{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to yulo-cs-note","text":""},{"location":"#aim","title":"Aim","text":"<p>yulo-cs-note is a collection of practical computer science knowledge. This site aims to provide quick guide, useful experiences for various computer technologies.</p>"},{"location":"#content","title":"Content","text":"<ul> <li>computer science</li> <li>program languages</li> <li>database</li> <li>cloud services</li> <li>useful tools</li> <li>ML &amp;&amp; AI</li> </ul>"},{"location":"#repository","title":"Repository","text":"<p>You can explore the full source and contribute on GitHub:   yuloxx/yulo-cs-note</p>"},{"location":"big-data/zookeeper/","title":"ZooKeeper","text":""},{"location":"big-data/zookeeper/#what-is-zookeeper","title":"What is ZooKeeper?","text":"<p>ZooKeeper is a reliable distributed service for coordination, which help nodes share consistent configurations, metadata and status. </p> <p>Most Important Functions:</p> <ul> <li>Configuration Management</li> <li>Metadata storage</li> <li>Event Listenser</li> <li>Leader Election</li> </ul>"},{"location":"big-data/zookeeper/#quick-start","title":"Quick Start","text":"<p>Precondition: a linux machine with jdk available </p> <p>Download Page: Apache ZooKeeper</p> <p>First, start a stand-alone zookeeper service</p> <pre><code>tar -xzvf apache-zookeeper-x.y.z-bin.tar.gz\n\n# Enter the root directory\ncd apache-zookeeper-x.y.z-bin\n\n# Create a config file\n# Default configuration: \n# tickTime=2000\n# dataDir=/tmp/zookeeper\n# clientPort=2181\ncp conf/zoo_sample.cfg conf/zoo.cfg\n\n# Start Server\n# If success, we will see:\n# ZooKeeper JMX enabled by default\n# Using config: zookeeper-path/bin/../conf/zoo.cfg\n# Starting zookeeper ... STARTED\nbin/zkServer.sh start\n\n# Check server status\n# If server works well, we will see:\n# Using config: zookeeper-path/bin/../conf/zoo.cfg\n# Client port found: 2181. Client address: localhost. Client SSL: false.\n# Mode: standalone\nbin/zkServer.sh status\n\n\n# Stop server\n# \nbin/zkServer.sh stop\n</code></pre> <p>Second, read or write some data(persistent node)</p> <pre><code># show znodes of a path\nls /\n\n# create a znode\ncreate /node1 \"hello\"\n\n# read node data\nget /node1\n\n# set node data\nset /node1 \"hello,zk\"\n\n# delete node data \ndeleteall /node1\n</code></pre>"},{"location":"big-data/zookeeper/#znode","title":"ZNode","text":"<p>Zookeeper maintains a tree directory data structure similar to file system.</p> <p>For example:</p> <pre><code>/\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 leader\n\u2502   \u2514\u2500\u2500 workers\n\u2514\u2500\u2500 locks\n</code></pre> <p>Znode Data:</p> <ul> <li>Data in bytes (no more than 1MB)</li> <li>Child nodes (not ephemeral)</li> <li>Stat data (version, timestamp)</li> </ul> <p>Znode Type:</p> <p>Persistent Znode exists even if restarted or session lost, which is designed for configuration.</p> <pre><code>create /app/config \"db=localhost\"\n</code></pre> <p>Ephemeral Znode disappear as session lost,  (There is mo children Znode in Ephemeral Znode) which is designed for service registration/heart beat/online status.</p> <pre><code>create -e /workers/worker-A \"10.0.0.1\"\n</code></pre> <p>Persistent Sequential Znode is used for distributed lock.</p> <pre><code>create -s /queue/job \"task1\"\n</code></pre> <p>result:</p> <pre><code>/queue\n  \u2514\u2500\u2500 job0000000001   (Persistent Sequential)\n</code></pre> <p>Ephemeral Sequential Znode  is used for distributed lock or leader election.</p> <pre><code>create -e -s /lock/node \"A\"\n</code></pre> <p>More than one client create ephemeral sequential znode in the same path. Client with the smallest sequential number gets the lock or wins the election.</p>"},{"location":"big-data/zookeeper/#watcher","title":"Watcher","text":"<p>Watcher provide a light weight mechanism to notify data change. Watching events include:</p> <ul> <li>children znode change</li> <li>znode data change</li> <li>znode delete</li> </ul> <p>Test:</p> <p>Open a connection by zkCli.sh in session S1.</p> <pre><code>zkCli.sh -server localhost:2181\ncreate /watch_example \"initial_data\"\n</code></pre> <p>Open another connection by zkCli.sh in session S2.</p> <pre><code>zkCli.sh -server localhost:2181\nget -w /watch_example\n</code></pre> <p>Update the data in session S1</p> <pre><code>set /watch_example \"updated_data\"\n</code></pre> <p>output in S2:</p> <pre><code>[zk: localhost:2181(CONNECTED) 0] get -w /watch_example\ninitial_data\n[zk: localhost:2181(CONNECTED) 1]\nWATCHER::\n\nWatchedEvent state:SyncConnected type:NodeDataChanged path:/watch_example zxid: 4\n</code></pre> <p>Notice:</p> <p>Watcher takes effects only once. Once triggered, following events will not be notified.  To keep watch a znode, it's necessary to register again.</p>"}]}