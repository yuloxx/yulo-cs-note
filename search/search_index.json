{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to yulo-cs-note","text":""},{"location":"#aim","title":"Aim","text":"<p>yulo-cs-note is a collection of practical computer science knowledge. This site aims to provide quick guide, useful experiences for various computer technologies.</p>"},{"location":"#content","title":"Content","text":"<ul> <li>computer science</li> <li>program languages</li> <li>database</li> <li>cloud services</li> <li>useful tools</li> <li>ML &amp;&amp; AI</li> </ul>"},{"location":"#repository","title":"Repository","text":"<p>You can explore the full source and contribute on GitHub:   yuloxx/yulo-cs-note</p>"},{"location":"big-data/zookeeper/","title":"ZooKeeper","text":""},{"location":"big-data/zookeeper/#what-is-zookeeper","title":"What is ZooKeeper?","text":"<p>ZooKeeper is a reliable distributed service for coordination, which help nodes share consistent configurations, metadata and status. </p> <p>Most Important Functions:</p> <ul> <li>Configuration Management</li> <li>Metadata storage</li> <li>Event Listenser</li> <li>Leader Election</li> </ul>"},{"location":"big-data/zookeeper/#quick-start","title":"Quick Start","text":"<p>Precondition: a linux machine with jdk available </p> <p>Download Page: Apache ZooKeeper</p> <p>First, start a stand-alone zookeeper service</p> <pre><code>tar -xzvf apache-zookeeper-x.y.z-bin.tar.gz\n\n# Enter the root directory\ncd apache-zookeeper-x.y.z-bin\n\n# Create a config file\n# Default configuration: \n# tickTime=2000\n# dataDir=/tmp/zookeeper\n# clientPort=2181\ncp conf/zoo_sample.cfg conf/zoo.cfg\n\n# Start Server\n# If success, we will see:\n# ZooKeeper JMX enabled by default\n# Using config: zookeeper-path/bin/../conf/zoo.cfg\n# Starting zookeeper ... STARTED\nbin/zkServer.sh start\n\n# Check server status\n# If server works well, we will see:\n# Using config: zookeeper-path/bin/../conf/zoo.cfg\n# Client port found: 2181. Client address: localhost. Client SSL: false.\n# Mode: standalone\nbin/zkServer.sh status\n\n\n# Stop server\n# \nbin/zkServer.sh stop\n</code></pre> <p>Second, read or write some data(persistent node)</p> <pre><code># show znodes of a path\nls /\n\n# create a znode\ncreate /node1 \"hello\"\n\n# read node data\nget /node1\n\n# set node data\nset /node1 \"hello,zk\"\n\n# delete node data \ndeleteall /node1\n</code></pre>"},{"location":"big-data/zookeeper/#znode","title":"ZNode","text":"<p>Zookeeper maintains a tree directory data structure similar to file system.</p> <p>For example:</p> <pre><code>/\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 leader\n\u2502   \u2514\u2500\u2500 workers\n\u2514\u2500\u2500 locks\n</code></pre> <p>Znode Data:</p> <ul> <li>Data in bytes (no more than 1MB)</li> <li>Child nodes (not ephemeral)</li> <li>Stat data (version, timestamp)</li> </ul> <p>Znode Type:</p> <p>Persistent Znode exists even if restarted or session lost, which is designed for configuration.</p> <pre><code>create /app/config \"db=localhost\"\n</code></pre> <p>Ephemeral Znode disappear as session lost,  (There is mo children Znode in Ephemeral Znode) which is designed for service registration/heart beat/online status.</p> <pre><code>create -e /workers/worker-A \"10.0.0.1\"\n</code></pre> <p>Persistent Sequential Znode is used for distributed lock.</p> <pre><code>create -s /queue/job \"task1\"\n</code></pre> <p>result:</p> <pre><code>/queue\n  \u2514\u2500\u2500 job0000000001   (Persistent Sequential)\n</code></pre> <p>Ephemeral Sequential Znode  is used for distributed lock or leader election.</p> <pre><code>create -e -s /lock/node \"A\"\n</code></pre> <p>More than one client create ephemeral sequential znode in the same path. Client with the smallest sequential number gets the lock or wins the election.</p>"},{"location":"big-data/zookeeper/#watcher","title":"Watcher","text":"<p>Watcher provide a light weight mechanism to notify data change. Watching events include:</p> <ul> <li>children znode change</li> <li>znode data change</li> <li>znode delete</li> </ul> <p>Test:</p> <p>Open a connection by zkCli.sh in session S1.</p> <pre><code>zkCli.sh -server localhost:2181\ncreate /watch_example \"initial_data\"\n</code></pre> <p>Open another connection by zkCli.sh in session S2.</p> <pre><code>zkCli.sh -server localhost:2181\nget -w /watch_example\n</code></pre> <p>Update the data in session S1</p> <pre><code>set /watch_example \"updated_data\"\n</code></pre> <p>output in S2:</p> <pre><code>[zk: localhost:2181(CONNECTED) 0] get -w /watch_example\ninitial_data\n[zk: localhost:2181(CONNECTED) 1]\nWATCHER::\n\nWatchedEvent state:SyncConnected type:NodeDataChanged path:/watch_example zxid: 4\n</code></pre> <p>Notice:</p> <p>Watcher takes effects only once. Once triggered, following events will not be notified.  To keep watch a znode, it's necessary to register again.</p>"},{"location":"big-data/zookeeper/#leader-election","title":"Leader Election","text":"<p>Zookeeper provide a reliable and simple way for leader election: create ephemeral sequential and elect the instance with least sequence number.</p> <p>Every instance of an application attempt to  create sequential znode under the election directory. The instance with the least sequential number is elected as the leader. </p> <pre><code>/myapp/leader/instance-0000000001\n/myapp/leader/instance-0000000002\n/myapp/leader/instance-0000000003\n...\n</code></pre> <p>Every instance watch the election znode directory. As the leader fails, sequential znode is removed, then election is triggered.</p> <p>Example Project:</p> <p>This project shows how to start a LeaderElection thread and work with business thread through a global state service. Maven package this project and run jar package to observe leader election process! </p> <pre><code>+---main\n|   +---java\n|   |   \\---org\n|   |       \\---example\n|   |               Application.java\n|   |               CuratorConfig.java\n|   |               LeaderController.java\n|   |               LeaderElectionService.java\n|   |               LeaderStateService.java\n|   |\n|   \\---resources\n|           application.yml\n|\npom.xml\n</code></pre> <p>pom.xml:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;org.example&lt;/groupId&gt;\n    &lt;artifactId&gt;my-spring&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;spring-boot.version&gt;2.7.6&lt;/spring-boot.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;\n            &lt;version&gt;4.3.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;\n            &lt;version&gt;4.3.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;\n            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;\n            &lt;version&gt;3.6.3&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;\n                &lt;version&gt;${spring-boot.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${spring-boot.version}&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;repackage&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre> <p>application.yml:</p> <pre><code>zookeeper:\n  connect-string: \"a.b.c.d:xxxx\"\n</code></pre> <p>Application</p> <pre><code>package org.example;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n</code></pre> <p>CuratorConfig</p> <pre><code>package org.example;\n\nimport org.apache.curator.framework.CuratorFramework;\nimport org.apache.curator.framework.CuratorFrameworkFactory;\nimport org.apache.curator.retry.ExponentialBackoffRetry;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class CuratorConfig {\n\n    @Value(\"${zookeeper.connect-string}\")\n    private String connectString;\n\n    @Bean(initMethod = \"start\")\n    public CuratorFramework curatorFramework() {\n        return CuratorFrameworkFactory.builder()\n                .connectString(connectString)\n                .sessionTimeoutMs(60000)\n                .connectionTimeoutMs(15000)\n                .retryPolicy(new ExponentialBackoffRetry(1000, 3))\n                .build();\n    }\n\n}\n</code></pre> <p>LeaderElectionService</p> <pre><code>package org.example;\n\nimport org.apache.curator.framework.CuratorFramework;\nimport org.apache.curator.framework.recipes.leader.LeaderSelector;\nimport org.apache.curator.framework.recipes.leader.LeaderSelectorListenerAdapter;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.stereotype.Service;\n\nimport javax.annotation.PostConstruct;\nimport javax.annotation.PreDestroy;\nimport javax.annotation.Resource;\n\n@Service\npublic class LeaderElectionService {\n\n    private static final String LEADER_PATH = \"/demo-app/leader_election\";\n\n    private static final Logger log = LoggerFactory.getLogger(LeaderElectionService.class);\n\n    @Resource\n    private CuratorFramework client;\n\n    @Resource\n    private LeaderStateService leaderStateService;\n\n    private LeaderSelector leaderSelector;\n\n    @PostConstruct\n    public void start() {\n        leaderSelector = new LeaderSelector(client, LEADER_PATH, new LeaderSelectorListenerAdapter() {\n\n            @Override\n            public void takeLeadership(CuratorFramework curatorFramework) throws Exception {\n                log.info(\"I'm leader now\");\n                leaderStateService.setLeader(true);\n\n                try {\n                    Thread.sleep(Long.MAX_VALUE);\n                } finally {\n                    leaderStateService.setLeader(false);\n                    log.info(\"I am no longer Leader.\");\n                }\n            }\n        });\n        leaderSelector.autoRequeue();\n        leaderSelector.start();\n        log.info(\"Leader election started.\");\n    }\n\n    @PreDestroy\n    public void stop() {\n        if (leaderSelector != null) {\n            leaderSelector.close();\n        }\n    }\n\n}\n</code></pre> <p>LeaderStateService</p> <pre><code>package org.example;\n\nimport org.springframework.stereotype.Component;\n\nimport java.util.concurrent.atomic.AtomicBoolean;\n\n@Component\npublic class LeaderStateService {\n    private final AtomicBoolean isLeader = new AtomicBoolean(false);\n\n    public boolean isLeader() {\n        return isLeader.get();\n    }\n\n    public void setLeader(boolean leader) {\n        isLeader.set(leader);\n    }\n}\n</code></pre> <p>LeaderController</p> <pre><code>package org.example;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.annotation.Resource;\n\n@RestController\npublic class LeaderController {\n\n    @Resource\n    private LeaderStateService leaderStateService;\n\n    @GetMapping(\"/isLeader\")\n    public String isLeader() {\n        return leaderStateService.isLeader() ? \"YES, I am leader\" : \"NO, I am follower\";\n    }\n}\n</code></pre>"},{"location":"cloud-service/elasticsearch/","title":"Elasticsearch","text":""},{"location":"cloud-service/elasticsearch/#what-is-elasticsearch","title":"What is Elasticsearch","text":"<p>Elasticsearch is a open-source search and analytics engine. It can quickly search through massive amounts of text data.  Its primary strength is finding relevant documents based on complex queries.</p>"},{"location":"cloud-service/elasticsearch/#concept","title":"Concept","text":"<ul> <li>Document: A json object contains business data(product description, log message, blog, ...)</li> <li> <p>Index: A collection of documents that have similar characteristics. Similar to \"table\" in RDBMS.</p> </li> <li> <p>Shard: Elasticsearch subdivides an index into multiple pieces called shards.</p> </li> </ul>"}]}